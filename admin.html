<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Transporte Escolar | Admin</title>
    
    <!-- Fontes Modernas -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>

    <!-- TELA DE LOGIN (Centralizada e Limpa) -->
    <div id="login-screen" class="login-wrapper">
        <div class="login-box glass-effect">
            <div class="login-icon">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h2>Acesso Administrativo</h2>
            <p>Secretaria de Educação</p>
            
            <form onsubmit="realizarLogin(event)">
                <div class="input-group">
                    <i class="fa-solid fa-lock"></i>
                    <input type="password" id="admin-pass" placeholder="Senha de Acesso" required autocomplete="current-password">
                    <i class="fa-solid fa-eye toggle-pass" onclick="toggleSenha()"></i>
                </div>
                <button type="submit" class="btn-login">
                    Acessar Painel <i class="fa-solid fa-arrow-right"></i>
                </button>
            </form>

            <a href="index.html" class="back-link">
                <i class="fa-solid fa-chevron-left"></i> Voltar ao Portal do Aluno
            </a>
        </div>
    </div>

    <!-- APP CONTAINER (Layout Principal) -->
    <div id="admin-panel" class="app-layout hidden">
        
        <!-- SIDEBAR (Barra Lateral Fixa) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-area">
                    <i class="fa-solid fa-bus-simple"></i>
                    <span>Transporte<br><small>Gestor 2.0</small></span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="menu-item active" onclick="switchTab('tab-dashboard')">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Dashboard</span>
                </button>
                <button class="menu-item" onclick="switchTab('tab-eventos')">
                    <i class="fa-solid fa-calendar-day"></i>
                    <span>Eventos</span>
                </button>
                <button class="menu-item" onclick="switchTab('tab-inscricoes')">
                    <i class="fa-solid fa-users-viewfinder"></i>
                    <span>Inscrições</span>
                </button>
                <button class="menu-item" onclick="switchTab('tab-relatorios')">
                    <i class="fa-solid fa-file-contract"></i>
                    <span>Relatórios</span>
                </button>
                <button class="menu-item" onclick="switchTab('tab-config')">
                    <i class="fa-solid fa-sliders"></i>
                    <span>Configurações</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" onclick="logout()">
                    <i class="fa-solid fa-power-off"></i> Sair
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT (Conteúdo Expansível) -->
        <main class="main-content">
            
            <!-- HEADER SUPERIOR -->
            <header class="top-bar">
                <div class="breadcrumbs">
                    <span id="page-title">Visão Geral</span>
                </div>
                <div class="user-info">
                    <span class="status-indicator"></span>
                    <span>Admin Online</span>
                </div>
            </header>

            <!-- CONTEÚDO DAS ABAS (Scrollável) -->
            <div class="content-scroll">
                
                <!-- 1. DASHBOARD -->
                <section id="tab-dashboard" class="view-section active">
                    <div class="toolbar">
                        <div class="filter-group">
                            <i class="fa-solid fa-filter"></i>
                            <select id="dash-filtro-evento" onchange="filtrarDashboard()">
                                <option value="">Carregando eventos...</option>
                            </select>
                        </div>
                        <button onclick="carregarDashboard()" class="btn-icon" title="Atualizar"><i class="fa-solid fa-rotate"></i></button>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card blue">
                            <div class="kpi-icon"><i class="fa-solid fa-users"></i></div>
                            <div class="kpi-data">
                                <h3 id="stat-total">0</h3>
                                <small>Total de Inscritos</small>
                            </div>
                        </div>
                        <div class="kpi-card green">
                            <div class="kpi-icon"><i class="fa-solid fa-check-double"></i></div>
                            <div class="kpi-data">
                                <h3 id="stat-aprovados">0</h3>
                                <small>Aprovados / Emitidos</small>
                            </div>
                        </div>
                        <div class="kpi-card orange">
                            <div class="kpi-icon"><i class="fa-solid fa-hourglass-half"></i></div>
                            <div class="kpi-data">
                                <h3 id="stat-pendentes">0</h3>
                                <small>Pendentes</small>
                            </div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card large">
                            <h4>Distribuição por Evento</h4>
                            <div class="canvas-wrapper"><canvas id="chartEventos"></canvas></div>
                        </div>
                        <div class="chart-card small">
                            <h4>Status Geral</h4>
                            <div class="canvas-wrapper"><canvas id="chartStatus"></canvas></div>
                        </div>
                    </div>
                </section>

                <!-- 2. EVENTOS -->
                <section id="tab-eventos" class="view-section hidden">
                    <div class="section-header">
                        <h2>Gerenciamento de Eventos</h2>
                        <button class="btn-action primary" onclick="modalNovoEvento()">
                            <i class="fa-solid fa-plus"></i> Novo Evento
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th width="50">ID</th>
                                    <th>Título do Evento</th>
                                    <th width="120">Status</th>
                                    <th width="150" align="right">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lista-eventos-admin">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- 3. INSCRIÇÕES -->
                <section id="tab-inscricoes" class="view-section hidden">
                    <div class="toolbar spread">
                        <div class="search-bar">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="filtro-nome" placeholder="Pesquisar por nome, CPF ou chave..." onkeyup="resetEFiltrar()">
                        </div>
                        <div class="filters-row">
                            <select id="filtro-evento" onchange="resetEFiltrar()"><option value="">Todos Eventos</option></select>
                            <select id="filtro-status" onchange="resetEFiltrar()">
                                <option value="">Todos Status</option>
                                <option value="Pendente">Pendente</option>
                                <option value="Aprovada">Aprovada</option>
                                <option value="Rejeitada">Rejeitada</option>
                            </select>
                            <button onclick="carregarInscricoes()" class="btn-icon"><i class="fa-solid fa-rotate"></i></button>
                        </div>
                    </div>

                    <div class="table-container full-height">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th width="40"><input type="checkbox" id="check-all" onclick="toggleAllChecks()"></th>
                                    <th width="100">Data</th>
                                    <th width="180">Evento</th>
                                    <th>Aluno / Chave</th>
                                    <th width="120">Status</th>
                                    <th width="160" align="right">Gerenciar</th>
                                </tr>
                            </thead>
                            <tbody id="lista-inscricoes-admin"></tbody>
                        </table>
                        <div class="load-more-area">
                            <button id="btn-load-more" class="btn-outline" onclick="renderizarProximaPagina()" style="display:none;">
                                Carregar Mais <i class="fa-solid fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 4. RELATÓRIOS -->
                <section id="tab-relatorios" class="view-section hidden">
                    <div class="grid-cards">
                        <div class="report-card">
                            <div class="icon-header"><i class="fa-solid fa-print"></i></div>
                            <h3>Lista de Transporte</h3>
                            <p>Gere o PDF oficial com a lista de alunos aprovados por rota ou instituição.</p>
                            
                            <div class="form-group">
                                <label>Evento Base</label>
                                <select id="relatorio-evento" class="full-width"><option>Carregando...</option></select>
                            </div>
                            <div class="form-group">
                                <label>Instituição (Opcional)</label>
                                <select id="relatorio-inst" class="full-width"><option>Todas</option></select>
                            </div>
                            
                            <button class="btn-action primary full-width" onclick="gerarRelatorioTransporte()">
                                Gerar Relatório PDF
                            </button>
                        </div>

                        <div class="report-card placeholder">
                            <i class="fa-solid fa-chart-simple"></i>
                            <h3>Estatísticas Avançadas</h3>
                            <p>Em breve: exportação para Excel e análise demográfica.</p>
                        </div>
                    </div>
                    <div id="area-impressao"></div>
                </section>

                <!-- 5. CONFIGURAÇÕES -->
                <section id="tab-config" class="view-section hidden">
                    <div class="grid-cards">
                        <div class="config-card">
                            <h3><i class="fa-solid fa-school"></i> Instituições de Ensino</h3>
                            <div class="add-row">
                                <input type="text" id="nova-inst" placeholder="Nome da nova instituição...">
                                <button class="btn-icon primary" onclick="addInstituicao()"><i class="fa-solid fa-plus"></i></button>
                            </div>
                            <div id="lista-instituicoes" class="scroll-list"></div>
                        </div>

                        <div class="config-card">
                            <h3><i class="fa-brands fa-google-drive"></i> Armazenamento</h3>
                            <p>Conecte uma pasta do Google Drive para salvar as fotos e documentos.</p>
                            <label>ID da Pasta</label>
                            <div class="add-row">
                                <input type="text" id="config-drive-id" placeholder="Ex: 1A2b3C...">
                                <button class="btn-icon primary" onclick="salvarConfigDrive()"><i class="fa-solid fa-save"></i></button>
                            </div>
                        </div>
                    </div>
                </section>

            </div> <!-- Fim content-scroll -->
        </main>
    </div>

    <!-- Barra Flutuante de Ações em Massa -->
    <div id="bulk-bar" class="bulk-bar hidden-bar">
        <div class="bulk-info"><span id="bulk-count">0</span> selecionados</div>
        <div class="bulk-actions">
            <button class="btn-bulk green" onclick="acaoEmMassa('Aprovada')"><i class="fa-solid fa-check"></i> Aprovar</button>
            <button class="btn-bulk red" onclick="acaoEmMassa('Rejeitada')"><i class="fa-solid fa-xmark"></i> Rejeitar</button>
            <button class="btn-bulk gray" onclick="desmarcarTudo()"><i class="fa-solid fa-minus"></i> Cancelar</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="admin.js"></script>
</body>
</html>
